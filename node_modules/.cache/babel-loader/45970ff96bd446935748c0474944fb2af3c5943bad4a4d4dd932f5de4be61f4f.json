{"ast":null,"code":"import { GraphQLClient } from \"graphql-request\";\n\n// Usar ruta relativa en desarrollo para que el proxy de CRA (setupProxy.js)\n// reenvíe las peticiones a tu backend local y evitar problemas de CORS.\nconst isDev = process.env.NODE_ENV === 'development';\nconst remoteEndpoint = \"https://3c004bf2d4d8.ngrok-free.app/graphql\";\nconst endpoint = isDev ? '/graphql' : remoteEndpoint;\nfunction createClient(url) {\n  return new GraphQLClient(url, {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n}\nconst baseClient = createClient(endpoint);\nexport const client = {\n  request: async (query, variables) => {\n    // Obtener el token actual del localStorage en cada petición\n    const token = localStorage.getItem('token');\n    const headers = token ? {\n      authorization: `Bearer ${token}`\n    } : {};\n\n    // Actualizar headers del cliente antes de cada petición\n    baseClient.setHeaders(headers);\n    try {\n      return await baseClient.request(query, variables);\n    } catch (err) {\n      const msg = (err === null || err === void 0 ? void 0 : err.message) || String(err);\n      // Mensaje más claro si estamos en dev y falla por CORS/network\n      if (isDev && /Failed to fetch|NetworkError|CORS/i.test(msg)) {\n        const friendly = new Error(\"Request failed from browser — likely CORS. If your backend is running locally, run it and let the CRA dev server proxy (setupProxy.js) forward /graphql. Or enable CORS on the server.\");\n        friendly.original = err;\n        throw friendly;\n      }\n      throw err;\n    }\n  },\n  // Método para actualizar headers manualmente si es necesario\n  setHeaders: headers => baseClient.setHeaders(headers)\n};","map":{"version":3,"names":["GraphQLClient","isDev","process","env","NODE_ENV","remoteEndpoint","endpoint","createClient","url","headers","baseClient","client","request","query","variables","token","localStorage","getItem","authorization","setHeaders","err","msg","message","String","test","friendly","Error","original"],"sources":["C:/Users/porta/OneDrive/Documentos/Univalle/MercaDEA/Panel-Amin-Nuevo/src/api/graphqlClient.js"],"sourcesContent":["import { GraphQLClient } from \"graphql-request\";\r\n\r\n// Usar ruta relativa en desarrollo para que el proxy de CRA (setupProxy.js)\r\n// reenvíe las peticiones a tu backend local y evitar problemas de CORS.\r\nconst isDev = process.env.NODE_ENV === 'development';\r\nconst remoteEndpoint = \"https://3c004bf2d4d8.ngrok-free.app/graphql\";\r\nconst endpoint = isDev ? '/graphql' : remoteEndpoint;\r\n\r\nfunction createClient(url) {\r\n  return new GraphQLClient(url, {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n}\r\n\r\nconst baseClient = createClient(endpoint);\r\n\r\nexport const client = {\r\n  request: async (query, variables) => {\r\n    // Obtener el token actual del localStorage en cada petición\r\n    const token = localStorage.getItem('token');\r\n    const headers = token ? { authorization: `Bearer ${token}` } : {};\r\n\r\n    // Actualizar headers del cliente antes de cada petición\r\n    baseClient.setHeaders(headers);\r\n\r\n    try {\r\n      return await baseClient.request(query, variables);\r\n    } catch (err) {\r\n      const msg = err?.message || String(err);\r\n      // Mensaje más claro si estamos en dev y falla por CORS/network\r\n      if (isDev && /Failed to fetch|NetworkError|CORS/i.test(msg)) {\r\n        const friendly = new Error(\"Request failed from browser — likely CORS. If your backend is running locally, run it and let the CRA dev server proxy (setupProxy.js) forward /graphql. Or enable CORS on the server.\");\r\n        friendly.original = err;\r\n        throw friendly;\r\n      }\r\n      throw err;\r\n    }\r\n  },\r\n\r\n  // Método para actualizar headers manualmente si es necesario\r\n  setHeaders: (headers) => baseClient.setHeaders(headers),\r\n};\r\n"],"mappings":"AAAA,SAASA,aAAa,QAAQ,iBAAiB;;AAE/C;AACA;AACA,MAAMC,KAAK,GAAGC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa;AACpD,MAAMC,cAAc,GAAG,6CAA6C;AACpE,MAAMC,QAAQ,GAAGL,KAAK,GAAG,UAAU,GAAGI,cAAc;AAEpD,SAASE,YAAYA,CAACC,GAAG,EAAE;EACzB,OAAO,IAAIR,aAAa,CAACQ,GAAG,EAAE;IAC5BC,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB;EAChD,CAAC,CAAC;AACJ;AAEA,MAAMC,UAAU,GAAGH,YAAY,CAACD,QAAQ,CAAC;AAEzC,OAAO,MAAMK,MAAM,GAAG;EACpBC,OAAO,EAAE,MAAAA,CAAOC,KAAK,EAAEC,SAAS,KAAK;IACnC;IACA,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IAC3C,MAAMR,OAAO,GAAGM,KAAK,GAAG;MAAEG,aAAa,EAAE,UAAUH,KAAK;IAAG,CAAC,GAAG,CAAC,CAAC;;IAEjE;IACAL,UAAU,CAACS,UAAU,CAACV,OAAO,CAAC;IAE9B,IAAI;MACF,OAAO,MAAMC,UAAU,CAACE,OAAO,CAACC,KAAK,EAAEC,SAAS,CAAC;IACnD,CAAC,CAAC,OAAOM,GAAG,EAAE;MACZ,MAAMC,GAAG,GAAG,CAAAD,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEE,OAAO,KAAIC,MAAM,CAACH,GAAG,CAAC;MACvC;MACA,IAAInB,KAAK,IAAI,oCAAoC,CAACuB,IAAI,CAACH,GAAG,CAAC,EAAE;QAC3D,MAAMI,QAAQ,GAAG,IAAIC,KAAK,CAAC,wLAAwL,CAAC;QACpND,QAAQ,CAACE,QAAQ,GAAGP,GAAG;QACvB,MAAMK,QAAQ;MAChB;MACA,MAAML,GAAG;IACX;EACF,CAAC;EAED;EACAD,UAAU,EAAGV,OAAO,IAAKC,UAAU,CAACS,UAAU,CAACV,OAAO;AACxD,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}