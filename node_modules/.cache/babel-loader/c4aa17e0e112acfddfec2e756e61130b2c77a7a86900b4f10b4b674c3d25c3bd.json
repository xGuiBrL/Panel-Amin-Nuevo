{"ast":null,"code":"import { GraphQLClient } from \"graphql-request\";\n\n// Endpoint base (sin asumir si tiene / final o no)\nconst endpointBase = \"https://3c004bf2d4d8.ngrok-free.app/graphql\";\n\n// Helper para crear cliente apuntando a una URL concreta\nfunction createClient(url) {\n  return new GraphQLClient(url, {\n    headers: {\n      \"Content-Type\": \"application/json\"\n    }\n  });\n}\n\n// Crear clientes para ambas variantes (con y sin slash)\nconst clientNoSlash = createClient(endpointBase);\nconst clientWithSlash = createClient(endpointBase + \"/\");\n\n// Wrapper con reintento automático en caso de 404 (Not Found)\nexport const client = {\n  request: async (query, variables) => {\n    const token = localStorage.getItem(\"token\");\n    const headers = token ? {\n      authorization: `Bearer ${token}`\n    } : {};\n\n    // Intento 1: con la URL sin slash\n    try {\n      clientNoSlash.setHeaders(headers);\n      return await clientNoSlash.request(query, variables);\n    } catch (err) {\n      var _err$response;\n      // Si fue 404 o Not Found, intentar con slash\n      const status = err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status;\n      const message = (err === null || err === void 0 ? void 0 : err.message) || String(err);\n      if (status === 404 || /not found/i.test(message)) {\n        try {\n          clientWithSlash.setHeaders(headers);\n          return await clientWithSlash.request(query, variables);\n        } catch (err2) {\n          // attach both errors for easier debugging\n          const wrapped = new Error(\"GraphQL request failed on both endpoints: \" + ((err2 === null || err2 === void 0 ? void 0 : err2.message) || err2));\n          wrapped.original = err;\n          wrapped.attempt = err2;\n          throw wrapped;\n        }\n      }\n\n      // No es un 404, volver a lanzar para que el caller lo procese\n      throw err;\n    }\n  },\n  // Exponer método para forzar headers manualmente\n  setHeaders: headers => {\n    clientNoSlash.setHeaders(headers);\n    clientWithSlash.setHeaders(headers);\n  }\n};","map":{"version":3,"names":["GraphQLClient","endpointBase","createClient","url","headers","clientNoSlash","clientWithSlash","client","request","query","variables","token","localStorage","getItem","authorization","setHeaders","err","_err$response","status","response","message","String","test","err2","wrapped","Error","original","attempt"],"sources":["C:/Users/porta/OneDrive/Documentos/Univalle/MercaDEA/Panel-Amin-Nuevo/src/api/graphqlClient.js"],"sourcesContent":["import { GraphQLClient } from \"graphql-request\";\r\n\r\n// Endpoint base (sin asumir si tiene / final o no)\r\nconst endpointBase = \"https://3c004bf2d4d8.ngrok-free.app/graphql\";\r\n\r\n// Helper para crear cliente apuntando a una URL concreta\r\nfunction createClient(url) {\r\n  return new GraphQLClient(url, {\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n  });\r\n}\r\n\r\n// Crear clientes para ambas variantes (con y sin slash)\r\nconst clientNoSlash = createClient(endpointBase);\r\nconst clientWithSlash = createClient(endpointBase + \"/\");\r\n\r\n// Wrapper con reintento automático en caso de 404 (Not Found)\r\nexport const client = {\r\n  request: async (query, variables) => {\r\n    const token = localStorage.getItem(\"token\");\r\n    const headers = token ? { authorization: `Bearer ${token}` } : {};\r\n\r\n    // Intento 1: con la URL sin slash\r\n    try {\r\n      clientNoSlash.setHeaders(headers);\r\n      return await clientNoSlash.request(query, variables);\r\n    } catch (err) {\r\n      // Si fue 404 o Not Found, intentar con slash\r\n      const status = err?.response?.status;\r\n      const message = err?.message || String(err);\r\n      if (status === 404 || /not found/i.test(message)) {\r\n        try {\r\n          clientWithSlash.setHeaders(headers);\r\n          return await clientWithSlash.request(query, variables);\r\n        } catch (err2) {\r\n          // attach both errors for easier debugging\r\n          const wrapped = new Error(\"GraphQL request failed on both endpoints: \" + (err2?.message || err2));\r\n          wrapped.original = err;\r\n          wrapped.attempt = err2;\r\n          throw wrapped;\r\n        }\r\n      }\r\n\r\n      // No es un 404, volver a lanzar para que el caller lo procese\r\n      throw err;\r\n    }\r\n  },\r\n\r\n  // Exponer método para forzar headers manualmente\r\n  setHeaders: (headers) => {\r\n    clientNoSlash.setHeaders(headers);\r\n    clientWithSlash.setHeaders(headers);\r\n  },\r\n};\r\n"],"mappings":"AAAA,SAASA,aAAa,QAAQ,iBAAiB;;AAE/C;AACA,MAAMC,YAAY,GAAG,6CAA6C;;AAElE;AACA,SAASC,YAAYA,CAACC,GAAG,EAAE;EACzB,OAAO,IAAIH,aAAa,CAACG,GAAG,EAAE;IAC5BC,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB;EAChD,CAAC,CAAC;AACJ;;AAEA;AACA,MAAMC,aAAa,GAAGH,YAAY,CAACD,YAAY,CAAC;AAChD,MAAMK,eAAe,GAAGJ,YAAY,CAACD,YAAY,GAAG,GAAG,CAAC;;AAExD;AACA,OAAO,MAAMM,MAAM,GAAG;EACpBC,OAAO,EAAE,MAAAA,CAAOC,KAAK,EAAEC,SAAS,KAAK;IACnC,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IAC3C,MAAMT,OAAO,GAAGO,KAAK,GAAG;MAAEG,aAAa,EAAE,UAAUH,KAAK;IAAG,CAAC,GAAG,CAAC,CAAC;;IAEjE;IACA,IAAI;MACFN,aAAa,CAACU,UAAU,CAACX,OAAO,CAAC;MACjC,OAAO,MAAMC,aAAa,CAACG,OAAO,CAACC,KAAK,EAAEC,SAAS,CAAC;IACtD,CAAC,CAAC,OAAOM,GAAG,EAAE;MAAA,IAAAC,aAAA;MACZ;MACA,MAAMC,MAAM,GAAGF,GAAG,aAAHA,GAAG,wBAAAC,aAAA,GAAHD,GAAG,CAAEG,QAAQ,cAAAF,aAAA,uBAAbA,aAAA,CAAeC,MAAM;MACpC,MAAME,OAAO,GAAG,CAAAJ,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEI,OAAO,KAAIC,MAAM,CAACL,GAAG,CAAC;MAC3C,IAAIE,MAAM,KAAK,GAAG,IAAI,YAAY,CAACI,IAAI,CAACF,OAAO,CAAC,EAAE;QAChD,IAAI;UACFd,eAAe,CAACS,UAAU,CAACX,OAAO,CAAC;UACnC,OAAO,MAAME,eAAe,CAACE,OAAO,CAACC,KAAK,EAAEC,SAAS,CAAC;QACxD,CAAC,CAAC,OAAOa,IAAI,EAAE;UACb;UACA,MAAMC,OAAO,GAAG,IAAIC,KAAK,CAAC,4CAA4C,IAAI,CAAAF,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEH,OAAO,KAAIG,IAAI,CAAC,CAAC;UACjGC,OAAO,CAACE,QAAQ,GAAGV,GAAG;UACtBQ,OAAO,CAACG,OAAO,GAAGJ,IAAI;UACtB,MAAMC,OAAO;QACf;MACF;;MAEA;MACA,MAAMR,GAAG;IACX;EACF,CAAC;EAED;EACAD,UAAU,EAAGX,OAAO,IAAK;IACvBC,aAAa,CAACU,UAAU,CAACX,OAAO,CAAC;IACjCE,eAAe,CAACS,UAAU,CAACX,OAAO,CAAC;EACrC;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}